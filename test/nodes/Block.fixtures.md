<!-- BEGIN_AUTOGENERATED -->

# Block Node Formatting

Represents a Ruby block that is passed to a method (`proc { |foo| bar }`)

<!-- END_AUTOGENERATED -->

## Formats

Before:

```ruby
foo { |foo| }
```

After:

```ruby
foo { |foo|}
```

## Consolidates a block to oneline

Before:

```ruby
->() {

}
```

After:

```ruby
-> {}
```

## Prints args correctly

Before:

```ruby
->(one, two, three = "default", *rest, **kwargs) do
  self.scope(status: "active")
end
```

After:

```ruby
->(one, two, three = "default", *rest, **kwargs) do
  self.scope(status: "active")
end
```

## Breaks up statements

Before:

```ruby
->() {
  break 1
  next 2
}
```

After:

```ruby
-> do
  break 1
  next 2
end
```

## Formats a single line to multi-line

Before:

```ruby
cascades.each_pair do |source_key, destinations|
  source_value = source_key.split(':').inject(config) { |memo, part| memo.try(:[], part) }
  next unless source_value.present?
end
```

After:

```ruby
cascades.each_pair do |source_key, destinations|
  source_value = source_key.split(":").inject(config) do |memo, part|
    memo.try(:[], part)
  end
  next unless source_value.present?
end
```

## Does not split on block arguments

Before:

```ruby
class Thing
  def add_default
    [].each do
      if true
        ad_config[code][color_config[:config_field]] ||=
          components.detect { |c| c["code"] == code }["settings"][
            color_config[:config_field]
          ] rescue color_config[:default_color]
      end
    end
  end
end
```

After:

```ruby
class Thing
  def add_default
    [].each do
      if true
        ad_config[code][color_config[:config_field]] ||= begin
          components.detect do |c|
            c["code"] == code
          end["settings"][color_config[:config_field]]
        rescue
          color_config[:default_color]
        end
      end
    end
  end
end
```

## When consolidated into one line, always wraps the args

Before:

```ruby
array :sequenced_ids do
  integer
end
```

After:

```ruby
array(:sequenced_ids) { integer }
```

## When appearing in chains preserves the multiline formatting

Before:

```ruby
self.find :things do
  where(1)
end.filter :apply do
  limit(1)
end
```

After:

```ruby
self.find(:things) { where(1) }.filter(:apply) { limit(1) }
```

## When consolidated into one line, always wraps the args #3

Before:

```ruby
self.find [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], many: :thing, in: :order, another: :option, and_something: :else do
  where(1).and(2).without(3).coalesce(4).take(5).leaving(6).behind(7)
end
```

After:

```ruby
self
  .find(
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
    many: :thing,
    in: :order,
    another: :option,
    and_something: :else
  ) { where(1).and(2).without(3).coalesce(4).take(5).leaving(6).behind(7) }
```

## Formats destructured args

Before:

```ruby
grouped_payloads.map do |(type, payloads)|
  typed_feed = feed.becomes(FEED_TYPE_MAP.fetch(type))
  typed_batch = batch_for(feed: typed_feed, incoming: payloads)
  typed_feed.batch_importer.new(typed_feed, typed_batch, audit).run
rescue StandardError => e
  ReportError.run(e, feed: feed, audit: audit)
  typed_batch.result.failed += payloads.size
  batch
end
```

After:

```ruby
grouped_payloads.map do |(type, payloads)|
  typed_feed = feed.becomes(FEED_TYPE_MAP.fetch(type))
  typed_batch = batch_for(feed: typed_feed, incoming: payloads)
  typed_feed.batch_importer.new(typed_feed, typed_batch, audit).run
rescue StandardError => e
  ReportError.run(e, feed: feed, audit: audit)
  typed_batch.result.failed += payloads.size
  batch
end
```
